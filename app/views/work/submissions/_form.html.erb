<%= javascript_include_tag '/parsley.js' %>

<%= form_for(work_form.model, url: work_form.form_path, id: 'form') do |form| %>

  <%= render 'shared/form_fields', resource: work_form, form: form %>

  <%= form.hidden_field :work_type_id, value: work_form.work_type_id %>
  <%= form.hidden_field :optimistic_lock_token, multiple: true, value: work_form.optimistic_lock_token %>

  <% if form.object.new_record %>
    <%= form.hidden_field :file, value: work_form.model.cached_file_data %>
    <%= field_set_tag t('cho.form.legend') do %>
      <%= form.label :file, t('cho.form.file_selection') %>
      <%= form.file_field :file %>
    <% end %>
  <% end %>

  <%= render 'errors', work: work_form if work_form.errors.any? %>

  <div class="actions pt-4">
    <%= form.submit work_form.submit_text, class: 'btn btn-outline-secondary' %>
  </div>
<% end %>

<script>
    $( document ).ready(function() {
        $('#work_submission_title').parsley();
        $('#form').parsley();

        window.Parsley.addAsyncValidator('mycustom', function (xhr) {
            console.log(this.$element);

            return 404 === xhr.status;
        }, 'http://localhost:3000/validator');
    });
</script>
